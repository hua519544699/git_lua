--图片路径
PIC_PATH = "/var/touchelf/scripts/cqb_images/"
--退出队伍
color_tuichuduiwu = { 0x84DFF7, 10, 6, 0x84DFF7, -5, -9, 0x8CDFEF, -13, -12, 0x7BC7DE, -8, 13, 0x84DFF7, 0, 14, 0x84E7FF, 8, 14, 0x84E7F7, 5, 2, 0x84E3EF, 1, 0, 0x84DFEF, -5, -5, 0x8CDFEF, -5, -10, 0x8CDFE7, -10, 1, 0x8CEBF7, 13, 0, 0x84CFE7 }
--神灯免费
color_mianfei = { 0xF7F3EF, 5, -5, 0xF7F7F7, 8, 4, 0xFFFBF7, 0, 14, 0xF7F3EF, 0, 24, 0xE7E3E7, 0, 0, 0xF7F3EF, 0, -4, 0xDEDFDE, -6, -6, 0xE7EBE7 }
--点击任务
color_renwu = { 0x5AAECE, 16, 13, 0xBDE7EF, -1, 11, 0x4AA6C6, 12, 0, 0xB5E7EF, 16, 4, 0xCEF7F7, 19, 12, 0xC6EFF7, 2, -3, 0x63B6C6, 1, 0, 0x63AECE, 3, 3, 0x6BBED6, 8, 8, 0x9CDBE7 }
--任务眼
color_renwuyan = { 0x84E3F7, 0, -15, 0x84DBEF, -8, -3, 0x84DFEF, 0, 13, 0x7BD7EF, 8, 1, 0x8CE3F7, 5, -9, 0x84E7F7, -4, 8, 0x84E3F7 }
--侦查任务
color_zhencha = { 0xE7E3E7, -8, -1, 0xEFF3F7, -1, -9, 0xFFF7F7, -2, 4, 0xFFFBFF, 3, 0, 0xEFF3EF, 3, 0, 0xEFF3EF, 3, 0, 0xEFF3EF }
--离开副本
color_likaifuben = { 0xADEBEF, -7, -44, 0x84E7F7, -12, 35, 0xADEFFF }
--点击兑换
color_duihuan = { 0xADEBEF, 6, -9, 0xA5EFF7, -5, 6, 0x9CE7F7, -2, 20, 0xB5F3FF, 4, 20, 0xADEFF7 }
--兑换讨伐令
color_duihuantfl = { 0x42AACE, 2, -29, 0x39AED6, 10, -25, 0x3192B5, 11, 34, 0x319ABD }
--断开连接
color_duankailianjie = { 0xF7FFFF, -7, 35, 0xF7FBFF, 3, -53, 0xF7FFFF, -1, 103, 0xFFFFFF, -4, 93, 0xFFFBFF }
--地图药品商人
color_ditushangren = { 0xEFF3EF, -13, -31, 0xF7F3EF, -3, -31, 0xEFEFEF, 1, -26, 0xCECFCE, -12, -21, 0xEFEFF7, -13, -14, 0xE7EFEF, -8, -13, 0xE7E7E7, -1, -10, 0xEFEFEF, -9, -5, 0xF7F3EF, -8, 3, 0x8C969C }
--穆鬼颜色
color_mugui = { 0x42AACE, 4, 1, 0x39AED6, 8, 1, 0x39A6C6, -4, -22, 0x42AECE, 7, -22, 0x39AED6, 0, -13, 0x318EAD, 9, -14, 0x31A2C6, 4, 1, 0x39AED6, 8, 1, 0x39A6C6, 7, 7, 0x399ABD, -5, 9, 0x399EC6, -3, 7, 0x39A6C6 }
--领取45级
color_45ji = { 0x9CDBE7, 9, 8, 0xADF3FF, 4, 38, 0x94C7CE, 0, 53, 0xA5EBF7, -2, 65, 0xA5E3EF, 4, 61, 0xADF7FF, 18, 72, 0xEFC7C6, 15, 75, 0xCED3D6, 22, 77, 0xD64142, 23, 80, 0xDE4142 }
--领取60级装备
color_60ji = { 0xADF3FF, 2, -29, 0xA5EBF7, -2, -6, 0xA5E3EF, -3, 24, 0xA5DFEF, -3, 37, 0xA5E3EF, 16, 44, 0x6B616B, 14, 47, 0xCED3D6, 18, 47, 0xBD2421, 21, 52, 0xD63839 }
--领取70级装备
color_70ji = { 0xADEFF7, 3, -14, 0xADF3FF, 8, -14, 0xB5F3FF, 0, 0, 0xADEFF7, 21, 54, 0xC63839, 18, 54, 0xC61010, 17, 51, 0xD69E9C, 24, 50, 0xEFD3CE, 27, 59, 0xDEAEAD, 18, 62, 0xDEC3BD, 20, 55, 0xC62C29 }
--挂机
color_guaji = { 0x082431, -32, -9, 0xA5EBF7, -27, -9, 0xA5E7EF, -22, -9, 0x8CCBCE, -24, -2, 0x94D3DE, -27, -2, 0x8CC7CE, -31, -2, 0x9CDBDE, -25, 5, 0xA5EBF7, -28, 5, 0xA5DBE7, -34, 8, 0xADEBF7, -23, 13, 0x9CDFE7, -34, 15, 0xADE7EF, -32, 9, 0xADE3E7 }
--离线挂机      463,795
color_lixianguaji = { 0xDEFFFF, -9, -265, 0xFFFBFF, 6, -192, 0xCED3DE, -11, -224, 0x7396AD, 7, -224, 0xEFF3F7, -8, -234, 0xEFEFEF }
--角色进入游戏
color_juesejinru = { 0x42D7FF, 1, -12, 0x31BAFF, 4, 19, 0x4AE7FF, 2, 41, 0x4AFBFF, 4, 53, 0x52FBFF, 28, 25, 0xBDFFFF, 32, 0, 0xC6FFFF, 29, -9, 0xB5FFFF, 26, -21, 0xADFFFF, 26, -4, 0xCEFFFF, 30, 54, 0xC6FFFF }
--断网重试
color_chongshi = { 0xA5E7EF, 8, -1, 0xA5EBF7, 11, 0, 0xADEFF7, -5, -1, 0x9CD3DE, 2, 19, 0xADF7FF, -4, 19, 0xA5E7EF }
--点击药数量输入框
color_yaoshurukuang = { 0xD6DFDE, 5, -4, 0xFFFBFF, 6, -1, 0xFFFFF7, -9, 0, 0xEFEBEF, -9, -3, 0xE7EBEF, -9, 3, 0xE7EBEF }
--退出队伍
color_tuichuduiwu = { 0x84DFF7, 10, 6, 0x84DFF7, -5, -9, 0x8CDFEF, -13, -12, 0x7BC7DE, -8, 13, 0x84DFF7, 0, 14, 0x84E7FF, 8, 14, 0x84E7F7, 5, 2, 0x84E3EF, 1, 0, 0x84DFEF, -5, -5, 0x8CDFEF, -5, -10, 0x8CDFE7, -10, 1, 0x8CEBF7, 13, 0, 0x84CFE7 }
color_jinbi = { 0xADEFF7, -6, 20, 0xADEFF7, -2, 20, 0xADEFF7, 5, 21, 0x73B2BD, -12, 20, 0xA5E3EF, -9, 25, 0x94D3DE, -13, 16, 0x4A696B }
--设置
color_shezhi = { 0x5ABEDE, -1, -9, 0x5AB6D6, 16, 2, 0xC6FBFF, -2, 10, 0x52B2DE, -7, 1, 0x52B2D6, 7, 4, 0xA5E7F7, 11, 10, 0xCEF7FF, -1, 11, 0x5AB6D6, 10, -9, 0xCEF7F7, 1, 4, 0x6BBEDE }
--发邮件
color_fayoujian = { 0xE7EFF7, -5, -14, 0xF7FBF7, 5, -18, 0xF7F3F7, 4, 7, 0xBDCBD6, -1, 28, 0xE7EBEF, 5, 28, 0xEFF3EF, -8, 7, 0xBDCBD6, 0, 0, 0xE7EFF7 }
--输入收件人
color_shoujianren = { 0xADF3FF, -4, 0, 0xADF7FF, 7, -2, 0xADEFF7, 4, -12, 0xADF3FF, -3, 38, 0xADEFF7 }
--邮件内容
color_youjianneirong = { 0xADF3FF, -6, -2, 0x9CDBE7, 7, -6, 0xB5F3FF, 6, 16, 0xADF3FF, 1, 36, 0xA5E3E7, 7, 40, 0xB5F3F7, 0, 64, 0xADF7FF, 6, 64, 0xADF3FF }
--已绑定
color_bangding = { 0xFFFFFF, -6, 0, 0xF7FBFF, -9, 3, 0xE7EBEF, -9, 12, 0xEFEBE7, -5, 15, 0xFFFFFF, 0, 13, 0xFFFFFF, 4, 13, 0xFFFFFF }
--收邮件
color_sendEmail = { 0xF7F7F7, 0, 5, 0xEFF3F7, 2, -11, 0xDEE7EF, -5, -23, 0xE7EFEF, 1, -23, 0xEFEFF7, 0, -33, 0xDEE7EF, -10, -36, 0xF7F7F7, -2, -40, 0xF7F7F7 }
--获得新物品使用
color_huode = { 0xFFFFFF, 7, -7, 0xF7FFFF, 7, 0, 0xFFFBFF, 1, 10, 0xFFFBFF, -1, 23, 0xF7FBFF, 5, 24, 0xE7EBEF }

--喊话UI
UI = {
    --{'InputBox{大量收购61级25万战力账号，出售请联系微信qmqj2015或QQ177986411}',          'contents',         '喊话内容：'},
    {'DropList{星陨阁|焚炎谷|圣丹塔|魔炎神谷|黑角魔域|云莲宗|迦南学院|加玛帝国|苍穹之巅|斗气大陆|------苹果二区|冰崖原|风暴岭|落雁湾|海心崖|天蛇谷|云兰山|黑狱平原|乌兰城|风雷谷|神罗天下|------苹果三区|迦南天池|大岭湿地|万化剑山|净莲妖地|皇天城|埋骨地|黄泉湖|鹰翼峡|青莲火山|幽海湖|------苹果四区|风韵五洲|大罗天阁|万毒宗|妖凤空间|无量谷|天翼宗|冰河城|万剑盟|古龙湖|灼火山脉|------苹果五区|蛮荒古城|天目山脉|天星山脉|灸火山脉|初出茅庐|炎帝现身|王者归来|上古石碑|古族萧家|极魔之道|------苹果六区|慕兰谷|万剑阁|古圣城|天冥宗|古龙岛|冰河谷|冰皇原|风雷阁|风雷山脉|炼狱山谷|------苹果七区|万箭齐发|云起龙骧|笑傲江湖|剑走偏锋|不羁天涯|剑啸九天|瀚海长空|策马屠龙|气贯长虹|问鼎天下|------苹果八区|技冠群雄|鸾回凤舞|龙隐江湖|天道无极|震天动地|纵横天下|天苍穹月|气压山河|力挽狂澜|仗剑江湖|------苹果九区|群雄争霸|问鼎苍穹|烽火燎原|儿女情长|情动苍穹|------斗鱼大区|斗鱼1服}',    'playerArea',     '角色所在区:' },
};
--清理邮件
function clearEmail()
    notifyMessage("提取邮件")
    logD("清理邮件")
    mSleep(2000)
    --点击邮件
    findPic("youjian.bmp",90, 464,80  , 526,142 )
    --点设置   没发现邮件的话
    findMuColor(color_shezhi,90, 458,2, 533,77)
    --点击邮件
    findPic("youjian.bmp",90, 464,80  , 526,142 )
    if findMuColor_boolean(color_sendEmail,90, 536,184 , 571,266 ) then
        time1 = os.time()
        while true do
            --异常判断
            exception()
            --空邮件与非空邮件
            findPic("laijian.bmp",90, 426,187 , 497,265 )
            findPic("laijian1.bmp",90,426,187 , 497,265 )
            --提取附件
            if findPic_boolean("tiqufujian.bmp",90,  20,677 ,  73,809 ) then
                click(x,y)
                --删除邮件
                findPic("Emailshanchu.bmp",90,  19,170 ,  77,290 )
            end
            --使用获得的物品
            for i = 1,4 do
                --使用获得的物品
                findMuColor(color_huode,90, 269,115 , 305,243 )
                --传承确定
                findPic("chuanchengqueding.bmp",90, 209,435 , 246,517 )
            end
            --提取附件
            if findPic_boolean("tiqufujian.bmp",90,  20,677 ,  73,809 ) then
                click(x,y)
            else
                --删除邮件
                findPicTime("Emailshanchu.bmp",90,  19,170 ,  77,290 )
                --确定删除
                findPic("quedingshanchu.bmp",90, 207,439 , 245,519 )
            end
            --超时10分钟退出
            time2 = os.time()
            if time2 - time1 >600 then
                notifyMessage("处理邮件10分钟超时")
                mSleep(1500)
                logD("邮件提取完毕")
                mSleep(2000)
                --关闭界面
                findPic("guanbiyoujian.bmp",90, 575,1068, 639,1134)
                return
            end
            --邮件删除完毕退出
            if not findPic_boolean("laijian.bmp",90, 426,187 , 497,265 ) and
                not findPic_boolean("laijian1.bmp",90,426,187 , 497,265 ) then
                --关闭界面
                findPic("guanbiyoujian.bmp",90, 575,1068, 639,1134) 
                --邮件提取完毕
                notifyMessage("邮件提取完毕")
                mSleep(1500)
                logD("邮件提取完毕")
                mSleep(2000)
                return
            end
        end
    end
end
--清理背包
function clearBag()
    notifyMessage("背包")
    mSleep(1500)
    --打开背包
    if findPic_boolean("beibao.bmp",90,   4,531 ,  57,594 ) then
        click(x,y)
        if findPic_boolean("beibao.bmp",90,   4,531 ,  57,594 ) then
            notifyMessage("未进入背包界面退出")
            mSleep(1500)
            logD("未进入背包界面退出")
            return
        end
        local hh = 0
        local lh = 0
        --没找到物品的次数
        local counts = 0
        --while lh < 4 then
        while hh < 4 do
            --l相隔12            --h相隔8
            --行方向间隔101      --列方向102
            --起始范围  428,560         结束范围     525,660
            --第一个格子坐标    橙色  0xFFFFB5    紫色为 0xE751E7    蓝色  0xC6DBEF   绿色   0x29D7BD     
            if findOneColor_boolean(0xFFFFB5,85,428-lh*102,560 +hh*101,525-lh*102,660+hh*101) or 
               findOneColor_boolean(0xE751E7,85,428-lh*102,560 +hh*101,525-lh*102,660+hh*101) or 
               findOneColor_boolean(0xC6DBEF,85,428-lh*102,560 +hh*101,525-lh*102,660+hh*101) or 
               findOneColor_boolean(0x29D7BD,85,428-lh*102,560 +hh*101,525-lh*102,660+hh*101) then
                click(x,y)
                --如果是药品,讨伐令,钱币,装备            差lanyao2大药
                if findPic_boolean("hongyao1.bmp",90, 440,14  , 513,92  ) or
                   findPic_boolean("hongyao2.bmp",90, 440,14  , 513,92  ) or
                   findPic_boolean("lanyao1.bmp",90, 440,14  , 513,92  ) or
                   findPic_boolean("lanyao2.bmp",90, 440,14  , 513,92  ) or
                   findPic_boolean("taofa.bmp",90, 440,14  , 513,92  ) or
                   findPic_boolean("qianbi.bmp",90, 440,14  , 513,92  ) or
                   findPic_boolean("kuobaojiejing.bmp",90,440,14  , 513,92)or
                   findPic_boolean("zhuangbei.bmp",90, 594,141 , 630,203 ) then
                    --取消显示
                    findPictf("guanbixianshi.bmp",90, 390,194 , 635,405 )
                end
                --只能使用不能出售的东西
                --大束玫瑰或晶钻,斗气丹,精华,装备箱子,金币
                if findPic_boolean("dasumeigui.bmp",90,440,14  , 513,92) or
                   findPic_boolean("jingzuan.bmp",90,440,14  , 513,92) or
                   findPic_boolean("douqidan.bmp",90,440,14  , 513,92) or
                   findPic_boolean("jinghua.bmp",90,440,14  , 513,92) or 
                   findPic_boolean("jinbi.bmp",90,440,14  , 513,92) or
                   findPic_boolean("zhuangbeixiangzi.bmp",90,440,14  , 513,92) then
                    --使用
                    findPictf("shiyong.bmp",90,  90,197 , 128,282 )
                    --最大
                    findPictf("zuida.bmp",90, 254,635 , 289,712 )
                    --确认使用
                    findPictf("querenshiyong.bmp",90, 164,517 , 198,620 )
                end
                --绑定的东西
                if findMuColor_boolean(color_bangding,90,5,2, 179,105 ) then
                    --出售
                    findPictf("chushou.bmp",90,  91,44  , 127,134 )
                    --使用
                    findPictf("shiyong.bmp",90,  90,197 , 128,282 )
                    --出售
                    findPictf("chushou.bmp",90,  91,44  , 127,134 )
                    --熔炼
                    findPictf("ronglian.bmp",90,  88,47  , 128,135 )
                    --最大
                    findPictf("zuida.bmp",90, 254,635 , 289,712 )
                    --确定熔炼
                    findPictf("quedingronglian.bmp",90, 205,430 , 249,523 )
                    --确认使用
                    findPictf("querenshiyong.bmp",90, 164,517 , 198,620 )
                    --熔炼确定提示
                    findPic("rongliantishi.bmp",90, 203,429 , 250,522 )
                else
                    --取消显示
                    findPictf("guanbixianshi.bmp",90, 390,194 , 635,405 )
                end
            else
                counts = counts +1
                if counts >=10 then
                    notifyMessage("背包清理完毕无色10")
                    mSleep(1500)
                    logD("背包清理完毕无色10")
                    --关闭背包界面
                    findPic("guanbibeibao.bmp",90, 582,1074, 639,1134)
                    return
                end
            end
            hh = hh + 1
            if hh>=4 then
                hh = 0
                lh = lh+1
            end
            if lh>=4 then
                notifyMessage("重置列的值")
                mSleep(1500)
                lh = 0
                hh = 0
                --滑动屏幕
                myMove_RL( 159,736 ,1200,778,20)
            end
        end
    end
end
--退出队伍
function tuiDui()
    notifyMessage("退出队伍")
    logD("退出队伍")
    mSleep(2000)
    --退出队伍
    findMuColor(color_tuichuduiwu,85, 290,19  , 332,58  )
    --点击队伍图标
    findPicLostColor("duiwu.bmp",85, 401,14  , 442,65,  0xFF00FF)
    --退出队伍
    findMuColor(color_tuichuduiwu,85, 290,19  , 332,58  )
    --关闭队伍界面
    findPic("guanbiduiwu.bmp",90, 578,1067, 638,1134)
end
--上下滑动函数
--参数x1,y1第一个点，x2，y2位第二个点，speed为滑动速度
--该函数旨在将滑动距离拆解,达到滑动更精确的目的
function myMove_UD(x1, y1, x2, y2,speed)
    local step = speed
    if y2 > y1 then step = -speed end 
    local cnt = math.abs((y2 - y1) /speed)
    if cnt == 0 then
        cnt = 1
        step = math.abs(y2 - y1)
    end
    touchDown(0, x1, y1)
    mSleep(50)
    for i = 1, cnt do
        mSleep(50)
        y1 = y1 - step
        touchMove(0, x1, y1)
    end
    touchUp(0)
    mSleep(100)
end
--左右滑动函数
--同myMove_UD
function myMove_RL(x1, y1, x2, y2,speed)
    local step = speed
    if x2 > x1 then step = -speed end 
    local cnt = math.abs((x2 - x1) / speed)
    if cnt == 0 then
        cnt = 1
        step = math.abs(x2 - x1)
    end
    touchDown(0, x1, y1)
	mSleep(50)
    for i = 1, cnt do
        mSleep(50)
        x1 = x1 - step
        touchMove(0, x1, y1)
    end
    touchUp(0)
    mSleep(100)
end
--忽略色找图返回boolean
function findPicLostColor_boolean(path,per,x1,y1,x2,y2,color)
    x,y = findImageInRegionFuzzy(PIC_PATH..path,per,x1,y1,x2,y2,color)
    if x~=-1 and y~=-1 then
        return true
    else
        return false
    end
end
function moveTo(x1,y1,x2,y2)
    logD("滑动屏幕")
    touchDown(0, x1, y1); 
    mSleep(100);            
    touchMove(0, x2, y2); 
    mSleep(100);            
    touchUp(0);
end

function logD(con)
    time = os.time()
    tt = os.date("*t", time)
    logDebug(tt.month.."月"..tt.day.."日  :  "..con.."1")
end
--寻找图片      并重置时间
function findPicTime(path,per,x1,y1,x2,y2)
    x,y = findImageInRegionFuzzy(PIC_PATH..path,per,x1,y1,x2,y2)
    if x~=-1 and y~=-1 then
        logD("时间重置")
        time1 = os.time()
        clicktf(x,y)
    end
end
--[[
function hanhua()
    --后台到前台
    qiantai()
    notifyMessage("开始喊话",2000)
    logD("开始喊话")
    mSleep(3000)
    --点击打开喊话窗口
    logD("打开喊话窗口")
    --发现进入游戏   退出
    x,y = findMultiColorInRegionFuzzy(color_juesejinru,90,2,888,113,1130)
    if x ~= -1 and y ~= -1 then
        return
    end
    --点击世界窗口
    click(  85,581 )
    --点击切换到键盘
    findPic("jianpan.bmp",90,  31,567 , 210,705 )
    --点击输入框
    findPic("shurukuang.bmp",90,  28,749 ,  92,937 )
    --click(  61,756 )
    
    --输入内容
    logD("喊话内容："..contents)
    inputText(contents)
    findPic("done.bmp",90, 239,822 , 524,1002)
    --点击发送
    logD("发送")
    findPic("fasong.bmp",90,  25,862 , 249,981 )
    
    findPic("guanbihanhua.bmp",90, 524,885 , 628,995 )
    --click( 590,956 )
    logD("关闭喊话窗口")
    mSleep(3000)
end
--]]
--点击事件
function clicktf(x,y)
    if x~=-1 and y~=-1 then
        touchDown(0,x,y)
        mSleep(math.random(100,200))
        touchUp(0)
        mSleep(1500)
    end
end
--点击事件
function click(x,y)
    if x~=-1 and y~=-1 then
        touchDown(0,x,y)
        mSleep(math.random(100,200))
        touchUp(0)
        mSleep(2000)
    end
end

--寻找图片
function findPic(path,per,x1,y1,x2,y2)
    x,y = findImageInRegionFuzzy(PIC_PATH..path,per,x1,y1,x2,y2)
    click(x,y)
end
--寻找图片讨伐
function findPictf(path,per,x1,y1,x2,y2)
    x,y = findImageInRegionFuzzy(PIC_PATH..path,per,x1,y1,x2,y2)
    clicktf(x,y)
end
--找图返回boolean值
function findPic_boolean(path,per,x1,y1,x2,y2)
    x,y = findImageInRegionFuzzy(PIC_PATH..path,per,x1,y1,x2,y2)
    if x~=-1 and y~=-1 then
        return true
    else
        return false
    end
end
--多点找色
function findMuColor(table,per,x1,y1,x2,y2)
    x,y = findMultiColorInRegionFuzzy(table,per,x1,y1,x2,y2)
    click(x,y)
end
--多点找色  并点击
function findMuColortf(table,per,x1,y1,x2,y2)
    x,y = findMultiColorInRegionFuzzy(table,per,x1,y1,x2,y2)
    clicktf(x,y)
end
--多点找色返回boolean值
function findMuColor_boolean(table,per,x1,y1,x2,y2)
    x,y = findMultiColorInRegionFuzzy(table,per,x1,y1,x2,y2)
    if x~=-1 and y~=-1 then
        return true
    else
        return false
    end
end
--找单色返回boolean值
function findOneColor_boolean(one,per,x1,y1,x2,y2)
    x,y = findColorInRegionFuzzy(one,per,x1,y1,x2,y2)
    if x~=-1 and y ~=-1 then
        return true
    else
        return false
    end
end
--找图忽略色
function findPicLostColor(path,per,x1,y1,x2,y2,color)
    x,y = findImageInRegionFuzzy(PIC_PATH..path,per,x1,y1,x2,y2,color)
    if x~=-1 and y~=-1 then
        click(x,y)
    end
end
--找图忽略色返回boolean
function findPicLostColor_boolean(path,per,x1,y1,x2,y2,color)
    x,y = findImageInRegionFuzzy(PIC_PATH..path,per,x1,y1,x2,y2,color)
    if x~=-1 and y~=-1 then
        return true
    else
        return false
    end
end
--获取文件中的信息  是否发邮件，角色大区，收钱号名字
function getName()
    --文件，一行，1,2，收钱名字，自己大区,是否发邮件
	local file,line,a1,a2,a3,name,is
	file = io.open("/var/touchelf/scripts/name.txt","r")
	for line in file:lines() do
        local list = split(line,",")
        a1=list[1]
        a2=list[2]
        a3=list[3]
        --获取大区和是否发邮件
        if a1 == playerArea then
            is=a2
            name=a3
            break 
        end
	end 	
	file:close()
    return is,name
end
--发邮件
function fayoujian()
    is,name = getName()
    if is == "是" and string.len(name)>1 then
        notifyMessage("发邮件")
        mSleep(2000)
        --点击邮件
        findPic("youjian.bmp",90, 464,80  , 526,142 )
        --点设置   没发现邮件的话
        findMuColor(color_shezhi,90, 458,2, 533,77)
        --点击邮件
        findPic("youjian.bmp",90, 464,80  , 526,142 )
        --点击发邮件
        findMuColor(color_fayoujian,90, 524,259 , 583,414 )
        --点击    请输入收件人名称
        findMuColor(color_shoujianren,90, 470,158 , 521,370 )
        --输入收件人名字
        inputText(name)
        --点击done
        findPic("done.bmp",90, 315,1   , 535,1003)
        --写邮件内容
        findMuColor(color_youjianneirong,90, 426,160 , 469,284 )
        --输入邮件内容
        inputText("邮件内容")
        --点击done
        findPic("done.bmp",90, 315,1   , 535,1003)
        --放入邮寄物品并发送
        fangru() 
    end
end
--放入邮寄物品
function fangru()
    --开始放入
    notifyMessage("放入")
    mSleep(2000)
    if findPic_boolean("fasongyoujian.bmp",90, 115,826 , 192,986 ) then
        local wz = 0
        --物品寄出数量
        local counts =0
        local timeyj1 = os.time()
        while counts <5 do
            while wz < 8 do
                --异常判断
                exception()
                --两格方向间隔78   缝隙6
                --第一个范围  15,218        结束范围     90,296
                --第一个格子坐标  85,250   橙色  0x5A2C21-    紫色为 0x39144A-    蓝色  0x102052-  绿色   0x004942-     
                if findOneColor_boolean(0x5A2C21,85,15,218+wz*78,90,296+wz*78) or
                   findOneColor_boolean(0x39144A,85,15,218+wz*78,90,296+wz*78) or
                   findOneColor_boolean(0x102052,85,15,218+wz*78,90,296+wz*78) or
                   findOneColor_boolean(0x004942,85,15,218+wz*78,90,296+wz*78) then
                    click(x,y)
                    if findPic_boolean("shenmiqianbi.bmp",90, 441,16  , 516,96  ) or
                       findPic_boolean("youjianzhuangbei.bmp",90, 588,98  , 631,207 ) then
                        --关闭物品信息
                        findPic("guanbiwuping.bmp",90, 500,250 , 638,369 )
                    end
                    --寄出
                    if findPic_boolean("jichu.bmp",90,    1,2   ,148,312 )then
                        click(x,y)
                        counts = counts +1
                        if counts >=5 then
                            notifyMessage("发件物品已满")
                            mSleep(1500)
                            logD("发件物品已满")
                            break
                        end
                    end
                    --装备寄出
                    findPic("zhuangbeijichu.bmp",90,  17,42  ,  56,128 )
                else
                    --关闭界面
                    findPic("guanbiyoujian.bmp",90, 575,1068, 639,1134)
                    --退出方法
                    return
                end
                wz = wz + 1
            end
            --[[
            if findOneColor_boolean(0xE7E363,90, 114,533 , 201,628 ) or
               findOneColor_boolean(0xBD38C6,90, 114,533 , 201,628 ) or
               findOneColor_boolean(0x08344A,90, 114,533 , 201,628 ) or
               findOneColor_boolean(0x21CBBD,90, 114,533 , 201,628 ) then
                notifyMessage("物品已放满")
                mSleep(1500)
                logD("物品已放满")
                break
            end
            --]]
            --滑动物品
            myMove_UD(  51,879 ,  48,450 ,20)
            
            wz=0
            if not findPic_boolean("fasongyoujian.bmp",90, 115,826 , 192,986 ) then
                notifyMessage("不在邮件界面")
                mSleep(1500)
                logD("不在邮件界面")
                return
            end
            --超时
            local timeyj2 = os.time()
            if timeyj2 - timeyj1 >600 then
                notifyMessage("发邮件超时")
                mSleep(1500)
                logD("发邮件超时")
                return
            end
        end
        --点击金币输入框
        click( 151,739 )
        --输入金币数量
        inputText("99999999")
        mSleep(1000)
        --点击done
        findPic("done_jinbi.bmp",90, 329,2   , 516,1131)
        --点击发送
        notifyMessage("发送",1000)
        mSleep(2000)
        findPic("fasongyoujian.bmp",90, 115,826 , 192,986 )
        --确定发送
        findPic("quedingfasong.bmp",90, 172,422 , 231,537 )
        --关闭界面
        findPic("guanbiyoujian.bmp",90, 575,1068, 639,1134)
        notifyMessage("邮件发送完毕")
        mSleep(3000)
    else
        notifyMessage("不在邮件界面")
        mSleep(1500)
        logD("不在邮件界面")
        return
    end
end
--分割字符串
--local list = Split("abc,123,345", ",")--示例
function split(szFullString, szSeparator)  
	local nFindStartIndex = 1  
	local nSplitIndex = 1  
	local nSplitArray = {}  
	while true do  
	   local nFindLastIndex = string.find(szFullString, szSeparator, nFindStartIndex)  
	   if not nFindLastIndex then  
		nSplitArray[nSplitIndex] = string.sub(szFullString, nFindStartIndex, string.len(szFullString))  
		break  
	   end  
	   nSplitArray[nSplitIndex] = string.sub(szFullString, nFindStartIndex, nFindLastIndex - 1)  
	   nFindStartIndex = nFindLastIndex + string.len(szSeparator)  
	   nSplitIndex = nSplitIndex + 1  
	end  
	return nSplitArray  
end  
--退出战斗
function tuizhan()
        notifyMessage("退战",2000)
        logD("退战")
        mSleep(3000)
        --左
        touchDown(0,  99,79  )
        mSleep(10000)
        touchUp(0)
        --等待5秒
        mSleep(5000)
        
        --右
        touchDown(0, 101,142 )
        mSleep(10000)
        touchUp(0)
        --等待5秒
        mSleep(5000)
        
        --上
        touchDown(0, 130,109 )
        mSleep(10000)
        touchUp(0)
        --等待5秒
        mSleep(5000)
        
        --下
        touchDown(0,  66,112 )
        mSleep(10000)
        touchUp(0)
        --等待5秒
        mSleep(5000)
end
--找角色
function zhaojuese()
    mSleep(2000)
    if findMuColor_boolean(color_juesejinru,90,2,888,113,1130) then
        logD("开始判断角色")
        mSleep(2000)
        if findPicLostColor_boolean("60duo.bmp",85, 410,94  , 482,421 ,0xFF00FF) then
            logD("点击角色1")
            mSleep(2000)
            click( 443,65  )
            --角色进入
            findMuColor(color_juesejinru,90,   2,888 , 113,1130)
        elseif findPicLostColor_boolean("60duo.bmp",85, 309,76  , 380,421 ,0xFF00FF) then
            logD("点击角色2")
            mSleep(2000)
            click( 347,65  )
            --角色进入
            findMuColor(color_juesejinru,90,   2,888 , 113,1130)
        elseif findPicLostColor_boolean("60duo.bmp",85, 218,93  , 292,421 ,0xFF00FF) then
            logD("点击角色3")
            mSleep(2000)
            click( 245,65  )
            --角色进入
            findMuColor(color_juesejinru,90,   2,888 , 113,1130)
        elseif findPicLostColor_boolean("60duo.bmp",85, 128,103 , 190,421 ,0xFF00FF) then
            logD("点击角色4")
            mSleep(2000)
            click( 150,65)
            --角色进入
            findMuColor(color_juesejinru,90,   2,888 , 113,1130)
        end
    end
end
-------------------------------------------------------------------------侦查------侦查------侦查------侦查------侦查----------------
--侦查
function zhencha()
    --后台到前台
    qiantai()
    notifyMessage("开始日常任务侦查",2000)
    logD("日常侦察任务开启")
    mSleep(3000)
    --点击日常
    findPic("richang.bmp",90, 460,938 , 560,1043)
    --事务所
    findPic("shiwusuo.bmp",90,  61,633 , 282,855 )
    --领取讨伐奖励
    findPic("tfjiangli.bmp",90,  23,253 ,  74,383 )
    --开始侦查
    findPic("kaishizhencha.bmp",90,   3,819 ,  98,994 )
    --如果已经开始那就是  继续侦查
    findPic("jixuzhencha.bmp",90,   4,825 ,  97,993 )
    --关闭事务所侦查界面
    findPic("guanbizhencha.bmp",90, 566,1066, 639,1133)
    --点开任务眼
    diankairenwu()
    mSleep(5000)
    --
    --第一点时间
    time1 = os.time()
    while true do
        --断网等操作
        exception()
        --进入游戏
        --登陆界面进入游戏
        findPic("jinruyouxi.bmp",90,  16,382 , 171,738 )
        findPic("jinruyouxi_2.bmp",90,16,382 , 171,738 )
        --角色进入
        findMuColor(color_juesejinru,90,   2,888 , 113,1130)
        --活动公告
        findPictf("huodong.bmp",90,  51,489 , 120,638 )
        --精彩内容
        findPictf("jingcaineirong.bmp",90, 539,887 , 625,981 )
        --精彩内容1
        findPictf("jingcaineirong1.bmp",90, 565,921 , 621,976 )
        --关闭离线挂机界面
        findPictf("guanbilixianguaji.bmp",90, 409,739 , 500,831 )
        --确定组队
        findPictf("chuanchengqueding.bmp",90, 209,435 , 246,517 )
        --获得新物品
        findMuColortf(color_huode,90, 269,115 , 305,243 )
        --间隔20
        local zcTime = os.time()
        if zcTime%20<2 then
            --点开任务眼
            diankairenwu()
        end
        --关闭配件
        findPictf("guanbipeijian.bmp",90, 227,509 , 291,628 )
        --[[
        --关闭弹窗
        
        if not findPic_boolean("tijiaorenwu.bmp",90,28,8, 126,323 ) and
           not findPic_boolean("jieshourenwu.bmp",90,  34,9   , 127,325 ) then
            guanbi()
        end
        --]]
        --提交任务
        findPicTime("tijiaorenwu.bmp",90,28,8, 126,323 )
        --接受任务
        findPicTime("jieshourenwu.bmp",90,  34,9   , 127,325 )
        --取消网络选择
        findPictf("wangluoquxiao.bmp",90,  68,526 , 142,638 )
        --跳过动画
        findPictf("tiaoguo.bmp",90, 579,0   , 638,108 )
        --关闭过场动画
        findPictf("dianjijixu.bmp",90,   1,1079,  42,1129)
        local time2 = os.time()
        if time2%4<2 then
            --点击任务自动寻路侦查
            findMuColortf(color_zhencha,90, 248,10  , 368,188 )
        end
        --使用获得的物品
        findMuColortf(color_huode,90, 269,115 , 305,243 )
        --立即装备
        findMuColortf(color_liji,90, 214,252 , 244,354 )
        --事务所
        findPictf("shiwusuo.bmp",90,  61,633 , 282,855 )
        --领取讨伐奖励
        findPictf("tfjiangli.bmp",90,  23,253 ,  74,383 )
        --开始侦查
        findPictf("kaishizhencha.bmp",90,   3,819 ,  98,994 )
        --如果已经开始那就是  继续侦查
        findPictf("jixuzhencha.bmp",90,   4,825 ,  97,993 )
        --断网重试
        findMuColortf(color_chongshi, 90,259,502 , 329,628 )
        --手机商城登陆取消
        findPictf("shangchengquxiao.bmp",90, 320,302 , 427,613 )
        --关闭对话
        for i = 1,10 do
            findPictf("duihua.bmp",90,   1,1091,  33,1121)
        end
        --关闭npc对话
        findPictf("guanbiNPC.bmp",90, 575,277 , 638,327 )
        --后台到前台
        qiantai()
        --超过7分钟还没提交任务或接受任务就执行死机操作,重启机子
        time2 = os.time()
        if (time2 - time1)>420 then
            --重置时间
            time1 = os.time()
            notifyMessage("进行重启",2000)
            mSleep(3000)
            logD("任务未接受提交重启操作")
            mSleep(1000)
            appKill("com.zeus.cangqiongbian")
            mSleep(4000)
            appRun("com.zeus.cangqiongbian")
            mSleep(5000)
        end
        ----[[
        --每过4分钟接受侦查
        local time4 = os.time()
        if time4%240 <7 then
            --关闭npc对话
            findPictf("guanbiNPC.bmp",90, 575,277 , 638,327 )
            --点击日常
            findPic("richang.bmp",90, 460,938 , 560,1043)
            --事务所
            findPic("shiwusuo.bmp",90,  61,633 , 282,855 )
            --领取讨伐奖励
            findPic("tfjiangli.bmp",90,   23,253 ,  74,383 )
            ----[[
            if findMuColor_boolean(color_duihuan,90, 279,314 , 352,436 ) and
               not findPic_boolean("kaishizhencha.bmp",90,   3,819 ,  98,994 ) and
               not findPic_boolean("jixuzhencha.bmp",90,   4,825 ,  97,993 ) then
                notifyMessage("没有可做的侦查任务")
                mSleep(1500)
                logD("没有可做的侦查任务")
                --关闭事务所侦查界面
                findPic("guanbizhencha.bmp",90, 566,1066, 639,1133)
                return
            end
            --]]
            --开始侦查
            findPic("kaishizhencha.bmp",90,   3,819 ,  98,994 )
            --如果已经开始那就是  继续侦查
            findPic("jixuzhencha.bmp",90,   4,825 ,  97,993 )
            --关闭事务所侦查界面
            findPic("guanbizhencha.bmp",90, 566,1066, 639,1133)
        end
        --]]
        ---------------------------------------------------------------------------------------------------------------------
        --案件完成时  下一个案件按钮
        if findPic_boolean("xiageanjian.bmp",90, 130,504 , 198,638 ) then
            logD("侦查任务完成退出任务")
            --点击下个案件按钮
            clicktf(x,y)
            break;
        end
    end
--]] 
    --关闭事务所侦查界面
    findPictf("guanbizhencha.bmp",90, 566,1066, 639,1133)
    
    notifyMessage("侦查任务当前环完成了",2000)
    mSleep(3000)
    
    --换讨伐令
    huantfl()
    --幻境罗盘
    hjlp()
    --塞尔谈沙漠
    setsm()
    --炎阳炼心塔副本
    lianxinFB()
    --关闭弹窗
    guanbi()
    --回天蛇付
    huitsf()
    --关闭
    guanbi()
    --是否在天蛇府
    isTsf()
end
--换取讨伐令
function huantfl()
    --后台到前台
    qiantai()
    notifyMessage("换取讨伐令",2000)
    logD("换取讨伐令")
    mSleep(3000)
    --点击日常
    findPic("richang.bmp",90, 460,938 , 560,1043)
    --事务所
    findPic("shiwusuo.bmp",90,  61,633 , 282,855 )
    
    --点击兑换
    findMuColor(color_duihuan,90, 279,314 , 352,436 )
    --兑换讨伐令
    findMuColor(color_duihuantfl,90, 140,432 , 233,560 )
    --确认兑换
    findPic("querenduihuan.bmp",90, 159,497 , 242,654 )
    
    mSleep(2000)
    --兑换讨伐令
    findMuColor(color_duihuantfl,90, 140,432 , 233,560 )
    --确认兑换
    findPic("querenduihuan.bmp",90, 159,497 , 242,654 )
    
    --关闭兑换界面
    findPic("guanbiduihuan.bmp",90, 559,1055, 639,1134)
    notifyMessage("兑换讨伐令完毕",2000)
    mSleep(3000)
    --关闭兑换界面
    findPic("guanbiduihuan.bmp",90, 559,1055, 639,1134)
end
----幻境罗盘打困难级别
function hjlp()
    mSleep(2000)
    --获取焦点
    qiantai()
    --退队伍
    tuiDui()
    --开始幻境罗盘
    mSleep(3000)
    --点击日常
    findPic("richang.bmp",90, 460,938 , 560,1043)
    --向右滑动
    findPic("xiangyou.bmp",85, 294,1073, 348,1114)
    --clicktf( 321,1100)
    --向右滑动
    findPic("xiangyou.bmp",85, 294,1073, 348,1114)
    --clicktf( 321,1100)
    --判断次数用完
    if findPicLostColor_boolean("luopancishu.bmp",90, 204,616 , 225,635 ,0xFF00FF) then
        notifyMessage("罗盘次数已用2次")
        logD("罗盘次数已用2次")
        mSleep(1500)
        --关闭副本进入界面
        findPic("guanbifuben.bmp",90, 578,1073, 638,1131)
        return
    end
    --点击幻境罗盘
    findPic("hjlp.bmp",90, 155,544 , 344,725 )
    --点击地狱级
    findPic("diyu.bmp",90,   9,756 , 217,954 )
    --进入副本
    findPic("jinrufuben.bmp",90,   7,745 , 110,918 )
    --判断是否有次数
    if findPic_boolean("jinrufuben.bmp",90,   7,745 , 110,918 ) then
        --发现进入游戏   退出
        if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
            return
        end
        --关闭副本进入界面
        findPic("guanbifuben.bmp",90, 578,1073, 638,1131)
        --clicktf( 615,1108)
        notifyMessage("幻境罗盘副本次数已用完",2000)
        logD("幻境罗盘副本无次数")
        mSleep(1000)
        return
    end
    --关闭副本进入界面
    findPic("guanbifuben.bmp",90, 578,1073, 638,1131)
    --第一点时间
    time1 = os.time()
    while true do
        --异常之类窗口
        exception()
        --点击挂机
        findMuColortf(color_guaji,90, 308,1040, 390,1131)
        --确认副本进入界面
        findPictf("querenjinru.bmp",90, 202,423 , 252,529 )
        --取消提示
        findPictf("quxiaots.bmp",90, 190,593 , 263,720 )
        --转动转盘
        findPicTime("zhuandong.bmp",90,  44,477 , 115,649 )
        
        --副本超时 4分钟
        local time2 = os.time()
        if time2-time1 >240  then
            time1 = os.time()
            notifyMessage("副本结束超时")
            mSleep(1500)
            logD("副本结束超时")
            return
        end
    end
end
--[[幻境罗盘打地狱级副本
function hjlp()
    --后台到前台
    qiantai()
    --退出队伍
    tuiDui()
    --开始幻境罗盘
    mSleep(3000)
    --点击日常
    findPic("richang.bmp",90, 460,938 , 560,1043)
    --发现进入游戏   退出
    if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
        return
    end
    --向右滑动
    findPic("xiangyou.bmp",85, 294,1073, 348,1114)
    --clicktf( 321,1100)
    --向右滑动
    findPic("xiangyou.bmp",85, 294,1073, 348,1114)
    --clicktf( 321,1100)
    --点击幻境罗盘
    findPic("hjlp.bmp",90, 155,544 , 344,725 )
    --点击地狱级
    findPic("diyu.bmp",90,   9,756 , 217,954 )
    --进入副本
    findPic("jinrufuben.bmp",90,   7,745 , 110,918 )
    --判断是否有次数
    if findPic_boolean("jinrufuben.bmp",90,   7,745 , 110,918 ) then
        notifyMessage("幻境罗盘副本次数已用完",2000)
        logD("幻境罗盘副本无次数")
        mSleep(1000)
        --发现进入游戏   退出
        if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
            return
        end
        --关闭副本进入界面
        findPic("guanbifuben.bmp",90, 578,1073, 638,1131)
        --clicktf( 615,1108)
        return
    end
    notifyMessage("开始幻境罗盘副本",2000)
    logD("开始幻境罗盘副本")
    mSleep(10000)
    
    --点击挂机
    findMuColor(color_guaji,90, 308,1040, 390,1131)
    
    --取消提示
    findPic("quxiaots.bmp",90, 190,593 , 263,720 )
    --点击挂机
    findMuColor(color_guaji,90, 308,1040, 390,1131)
    --等待转盘
    mSleep(10000)
    
    mSleep(5000)
    --点击挂机
    findMuColor(color_guaji,90, 308,1040, 390,1131)
    
    mSleep(5000)
    --点击挂机
    findMuColor(color_guaji,90, 308,1040, 390,1131)
    
    mSleep(5000)
    --点击挂机
    findMuColor(color_guaji,90, 308,1040, 390,1131)
    
    mSleep(5000)
    --点击挂机
    findMuColor(color_guaji,90, 308,1040, 390,1131)
    
    mSleep(5000)
    --点击挂机
    findMuColor(color_guaji,90, 308,1040, 390,1131)
    
    mSleep(5000)
    --点击挂机
    findMuColor(color_guaji,90, 308,1040, 390,1131)
    --等待6分钟
    --副本持续时间
    mSleep(360000)
    --副本结束
    notifyMessage("副本结束",2000)
    
    mSleep(3000)
    
    --纳戒已完成
    findPic("wancheng.bmp",90, 171,112 , 301,357 )
end
--]]
--点开任务
function diankairenwu()
    if not findMuColor_boolean(color_renwuyan,90, 254,3 , 316,68 ) then
        logD("任务眼关闭状态下打开任务眼")
        --点击打开任务眼
        findMuColor(color_renwu,90, 288,0, 408,94)
    end
    --发现进入游戏   退出
    if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
        return
    end
    --下
    touchDown(0,  66,112 )
    mSleep(500)
    touchUp(0)
    --上
    mSleep(200)
    touchDown(0, 130,110 )
    mSleep(500)
    touchUp(0)
    --点击任务自动寻路
    findMuColor(color_zhencha,90, 248,10  , 368,188 )
    mSleep(4000)
end
-- 塞尔坦沙漠打地狱级别的
function setsm()
    --后台到前台
    qiantai()
    --退出队伍
    tuiDui()
    mSleep(3000)
    --点击日常
    findPic("richang.bmp",90, 460,938 , 560,1043)
    --发现进入游戏   退出
    if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
        return
    end
    --向右滑动
    findPic("xiangyou.bmp",85, 294,1073, 348,1114)
    --clicktf( 321,1100)
    --向右滑动
    findPic("xiangyou.bmp",85, 294,1073, 348,1114)
    --clicktf( 321,1100)
    --点击塞尔谈沙漠开始
    findPic("shamo.bmp",90, 221,417 , 425,615 )
    --点击地狱级别
    findPic("diyushamo.bmp",90,   6,749 , 223,956 )
    
    --进入沙漠副本
    findPic("jintushamo.bmp",90,   4,737 , 111,919 )
    --判断副本是否有次数
    if findPic_boolean("jintushamo.bmp",90,   9,744 , 116,926 ) then
        notifyMessage("沙漠副本次数已用完",2000)
        logD("沙漠副本无次数")
        mSleep(1000)
        --关闭副本界面
        findPic("guanbishamo.bmp",90, 579,1069, 639,1133)
        --clicktf( 615,1108)
        return
    end
    
    notifyMessage("塞尔谈沙漠开始",2000)
    logD("开始沙漠副本")
    mSleep(3000)
    --------------------------------------------------------------------------------------------------------------------------------
    time1 = os.time()
    while true do
        --判断副本是否有次数
        if findPic_boolean("jintushamo.bmp",90,9,744 , 116,926 ) then
            return
        end
        --是否在副本里面
        if findPic_boolean("fbguanbi.bmp",90,9,744 , 116,926 ) then
            return
        end
        --副本超时30分钟  重启1800
        time2 = os.time()
        if (time2 - time1)>1800 then
            --退出副本
            findPictf("tuichufb.bmp",90, 509,1035, 567,1094)
            --确定退出
            findPictf("quedingtuichu.bmp",90, 207,434 , 246,521 )
            notifyMessage("进行重启",2000)
            mSleep(3000)
            logD("沙漠副本超时重启操作")
            time1 = os.time()
            --关闭游戏在开启游戏
            appKill("com.zeus.cangqiongbian")
            mSleep(4000)
            appRun("com.zeus.cangqiongbian")
            mSleep(5000)
            return
        end
        --异常判断
        exception()
        --后台到前台
        qiantai()
        --断线登陆界面退出循环
        if findPic_boolean("jinruyouxi.bmp",90, 16,382 , 171,738 ) then
            logD("沙漠副本掉线")
            zhaojuese()
            --角色进入
            findMuColor(color_juesejinru,90,   2,888 , 113,1130)
            mSleep(20000)
            return
        end
        
        --取消网络选择
        findPic("wangluoquxiao.bmp",90,  68,526 , 142,638 )
        --防卡死不动
        kasi()
        --开始挂机
        findMuColor(color_guaji,90, 308,1040, 390,1131)
        --立即使用
        findPic("lijishiyong.bmp",90, 166,7   , 349,380 )
        --断网重试
        findMuColor(color_chongshi, 90,259,502 , 329,628 )
        --手机商城登陆取消
        findPic("shangchengquxiao.bmp",90, 320,302 , 427,613 )
 --[[       
        --副本退出图标
        x,y = findImageInRegionFuzzy(PIC_PATH.."fbchukou.bmp",90,   2,622 , 636,1132)
        if x==-1 and y == -1 then
            mSleep(10000)
            x,y = findImageInRegionFuzzy(PIC_PATH.."fbchukou.bmp",90,   2,622 , 636,1132)
            if x==-1 and y == -1 then
                return
            end
        end
--]]        
        --关闭副本
        --findPic("guanbifb.bmp",90, 562,1063, 638,1132)
        --离开副本提示
        --notifyMessage("离开副本判断")
        --mSleep(2000)
        
        ----------------------------------------------------------------------------------------------------------------------------
        --退出确定
        if findMuColor_boolean(color_likaifuben,90, 3,932 ,  78,1110) then
            logD("退出沙漠副本")
            mSleep(5000)
            --点击退出确定
            clicktf(x,y)
            mSleep(5000)
            findMuColor(color_likaifuben,90, 3,932 ,  78,1110)
            notifyMessage("退出副本",2000)
            mSleep(5000)
            
            break
        end
        
    end
    
    notifyMessage("赛坛沙漠副本结束",2000)
    mSleep(5000)
end
--炎阳炼心塔
function lianxinFB()
    --后台到前台
    qiantai()
    --退出队伍
    tuiDui()
    mSleep(3000)
    --点击日常
    findPic("richang.bmp",90, 460,938 , 560,1043)
    --发现进入游戏   退出
    if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
        return
    end
    --向右滑动
    findPic("xiangyou.bmp",85, 294,1073, 348,1114)
    --clicktf( 321,1100)
    --向右滑动
    findPic("xiangyou.bmp",85, 294,1073, 348,1114)
    --clicktf( 321,1100)
    --点击炎阳炼心塔开始
    findPic("yanyang.bmp",90, 217,351 , 309,445 )
    --点击地狱级别
    findPic("diyuyanyang.bmp",90,  34,791 , 143,925 )
    
    --进入炎阳副本
    findPic("jinruyanyang.bmp",90,   4,737 , 111,919 )
    --判断副本是否有次数
    if findPic_boolean("jinruyanyang.bmp",90,   9,744 , 116,926 ) then
        notifyMessage("炎阳副本次数已用完",2000)
        logD("炎阳副本无次数")
        mSleep(1000)
        --关闭副本界面
        findPic("guanbiyanyang.bmp",90, 579,1069, 639,1133)
        --clicktf( 615,1108)
        return
    end
    
    notifyMessage("炎阳谈沙漠开始",2000)
    logD("开始炎阳副本")
    mSleep(3000)
    --------------------------------------------------------------------------------------------------------------------------------
    time1 = os.time()
    while true do
        --判断副本是否有次数
        if findPic_boolean("jinruyanyang.bmp",90,9,744 , 116,926 ) then
            return
        end
        --是否在副本里面
        if findPic_boolean("guanbiyanyang.bmp",90, 579,1069, 639,1133) then
            return
        end
        --副本超时30分钟  重启1800
        local time2 = os.time()
        if (time2 - time1)>1800 then
            --退出副本
            findPic("tuichufb.bmp",90, 509,1035, 567,1094)
            mSleep(2000)
            --确定退出
            findPictf("quedingtuichu.bmp",90, 207,434 , 246,521 )
            notifyMessage("炎阳副本超时进行重启",2000)
            mSleep(3000)
            logD("炎阳副本超时重启操作")
            time1 = os.time()
            --关闭游戏在开启游戏
            appKill("com.zeus.cangqiongbian")
            mSleep(4000)
            appRun("com.zeus.cangqiongbian")
            mSleep(5000)
            return
        end
        --异常判断
        exception()
        --后台到前台
        qiantai()
        --断线登陆界面退出循环   
        if findPic_boolean("jinruyouxi.bmp",90, 16,382 , 171,738 ) then
            logD("炎阳副本掉线")
            zhaojuese()
            --角色进入
            findMuColor(color_juesejinru,90,   2,888 , 113,1130)
            mSleep(20000)
            return
        end
        
        --取消网络选择
        findPic("wangluoquxiao.bmp",90,  68,526 , 142,638 )
        --防卡死不动
        kasi()
        --开始挂机
        findMuColor(color_guaji,90, 308,1040, 390,1131)
        --立即使用
        findPic("lijishiyong.bmp",90, 166,7   , 349,380 )
        --断网重试
        findMuColor(color_chongshi, 90,259,502 , 329,628 )
        --手机商城登陆取消
        findPic("shangchengquxiao.bmp",90, 320,302 , 427,613 )
        ----------------------------------------------------------------------------------------------------------------------------
        --退出确定
        if findMuColor_boolean(color_likaifuben,90, 3,932 ,  78,1110) then
            logD("退出炎阳副本")
            mSleep(5000)
            --点击退出确定
            clicktf(x,y)
            mSleep(5000)
            findMuColor(color_likaifuben,90, 3,932 ,  78,1110)
            notifyMessage("退出副本",2000)
            mSleep(5000)
            break
        end
    end
    notifyMessage("炎阳副本结束",2000)
    logD("炎阳副本结束")
    mSleep(5000)
end

--买药
function maiyao()
    --后台到前台
    qiantai()
    notifyMessage("买药",2000)
    logD("买药")
    mSleep(3000)
---[[
    --发现进入游戏   退出
    if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
        return
    end
    --点开地图
    
    click( 585,1065)
    --点回城
    --click(  46,1052)
    findPic("huicheng.bmp",90,   3,956 , 100,1133)
    --确定回城
    --click( 229,475 )
    findPic("quedinghuicheng.bmp",90, 193,413 , 262,534 )
    --10秒
    mSleep(10000)
    --发现进入游戏   退出
    if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
        return
    end
    --点开地图
    click( 585,1065)
    --点击药NPC寻路
    findMuColor(color_ditushangren,90, 243,427 , 430,722 )
    mSleep(3000)
    --关闭地图
    --click( 614,1110)
    findPic("guanbiditu.bmp",90, 575,1071, 640,1135)
    --发现进入游戏   退出
    if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
        return
    end
    --点击药店商人
    if findPic_boolean("NPC.bmp",90, 308,987 , 402,1067) then
        notifyMessage("点击NPC")
        mSleep(1500)
        click(x,y)
    end
    --click( 205,541 )
    --点按钮买药
    --click( 321,148 )
    ------------------------------------------------------------------------------------------------------------------------
    x,y = findPic("yaopinganniu.bmp",90, 271,8   , 376,327 )
    if x~=-1 and y~=-1 then
        --买红
        --click( 435,200 )
        findPic("hong.bmp",90, 242,133 , 592,361 )
        --发现进入游戏   退出
        if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
            return
        end
        --点输入数量
        findMuColor(color_yaoshurukuang,90, 344,307 , 399,486 )
        --click( 373,392 )
        inputText(999)
        --点击done
        findPic("done.bmp",90, 315,1   , 535,1003)
        --click( 467,1060)
        --多次买
        for i = 1,2 do
            --买
            --click( 290,421 )
            findPic("goumaih.bmp",90, 140,337 , 549,524 )
            --购买确定
            --click( 229,478 )
            findPic("maiquedingh.bmp",90, 187,404 , 266,544 )
        end
        --发现进入游戏   退出
        if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
            return
        end
        --买蓝
        --click( 532,200 )
        findPic("lan.bmp",90, 500,172 , 566,233 )
        --点输入数量
        findMuColor(color_yaoshurukuang,90, 440,304 , 496,484 )
        --click( 468,391 )
        inputText(999)
        --点击done
        findPic("done.bmp",90, 315,1   , 535,1003)
       -- click( 467,1060)
        --多次买
        for i = 1,7 do
            --买
            --click( 381,423 )
            findPic("goumail.bmp",90, 351,359 , 420,481 )
            --购买确定
            --click( 228,477 )
            findPic("maiquedingl.bmp",90, 193,413 , 267,543 )
        end
    end
    --关闭药店
    findPic("guanbiyaodian.bmp",90, 568,1058, 639,1134)
--]]
    --回天蛇付
    huitsf()
    isTsf()
end
--------------------------------------------------------------------------------回天蛇付-----------------------------------------
function huitsf()
    --后台到前台
    qiantai()
    notifyMessage("回天蛇付",2000)
    logD("huitsf回天蛇付")
    mSleep(3000)
    --发现进入游戏   退出
    if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
        return
    end
    --点开地图
    click( 580,1074)
    --点击世界地图
    --click(  50,895 )
    findPic("sjditu.bmp",90,   4,808 ,  99,981 )
    --点黑狱平原
    findPic("heiyupingyuan.bmp",90, 143,384 , 265,525 )
    --点穆鬼
    findMuColor(color_mugui,90,  36,794 , 583,1005)
    --选择移动过去
    findPic("tsfyidong.bmp",90, 259,577 , 326,702 )
    --关闭移动
    findPic("guanbiyidong.bmp",90, 432,703 , 491,761 )
    --关闭世界地图
    findPic("guanbishijie.bmp",90, 579,1076, 640,1134)
    mSleep(70000)
end


--奇遇
function qiyu()
    --后台到前台
    qiantai()
    notifyMessage("奇遇",2000)
    logD("开始奇遇")
    mSleep(3000)
    --点击奇遇
    findPic("qiyu.bmp",90, 452,878 , 554,1036)
    --招财
    findPic("zhaocai.bmp",90, 311,261 , 490,451 )
    --有没有使用次数
    if findMuColor_boolean(color_mianfei,90,  25,436 ,  49,483 ) then
        --摩擦神灯
        findPic("shendeng.bmp",90, 128,389 , 460,768 )
    end
    --取消使用金砖
    findPic("quxiaoJZ.bmp",90, 187,584 , 273,730 )
    --关闭招财
    findPic("guanbizhaocai.bmp",90, 551,1045, 638,1132)
    --领奖
    lingjiang()
    --天降神兵
    shenbing()
    --锻炉
    duanlu()
    --清理背包
    clearBag()
    --清理邮件
    clearEmail()
end

function duanlu()
    --后台到前台
    qiantai()
    --开始锻炉
    notifyMessage("锻炉",2000)
    logD("锻炉")
    mSleep(3000)
    --打开背包
    findPic("beibao.bmp",90,   4,531 ,  57,594 )
    --click(  31,568 )
    --点击锻炉
    findPic("duanlu.bmp",90,   2,547 ,  88,700 )
    --一件放入，一件合成
    for i = 1,6 do
        --放入
        findPic("fangru.bmp",90,   7,262 ,  99,430 )
        --合成
        findPic("hecheng.bmp",90,   7,270 ,  99,437 )
    end
    --随身商店
    findPic("suishenshangdian.bmp",90,   3,822 ,  94,983 )
    --点击出售白装提示
    findPic("baizhuangqueding.bmp",90, 193,407 , 263,543 )
    --关闭背包
    findPic("guanbibeibao.bmp",90, 568,1051, 639,1131)
    --
    mSleep(2000)
    
end
--看是否在天蛇府
function isTsf()
    --社区图标
    if findPic_boolean("shequ.bmp",90, 536,639 , 634,857 ) then
        --后台到前台
        qiantai()
        notifyMessage("判断是否在天蛇府",1500)
        logD("判断是否在天蛇府")
        mSleep(2000)
        --发现进入游戏   退出
        if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
            return
        end
        --点开地图
        click( 580,1074)
        --点击世界地图
        --click(  50,895 )
        findPic("sjditu.bmp",90,   4,808 ,  99,981 )
        if not findPic_boolean("tianshefu.bmp",90, 215,386 , 258,425 ) then
            logD("不在天蛇府")
            --点黑狱平原
            findPic("heiyupingyuan.bmp",90, 143,384 , 265,525 )
            --点穆鬼
            findMuColor(color_mugui,90,  36,794 , 583,1005)
            --选择移动过去
            findPic("tsfyidong.bmp",90, 259,577 , 326,702 )
            mSleep(15000)
            --关闭地图
            findPic("guanbisjditu.bmp",90, 571,1063, 638,1132)
            mSleep(55000)
        else
            logD("在天蛇府")
            --关闭地图
            findPic("guanbisjditu.bmp",90, 571,1063, 638,1132)
        end
    end
end
--领奖
function lingjiang()
    --后台到前台
    qiantai()
    notifyMessage("开始领奖",2000)
    mSleep(3000)
    --点击界面领奖
    findPic("lingjiang.bmp",90, 541,938 , 630,1035)
    --点击界面领奖2
    findPic("lingjiang_1.bmp",90, 541,944 , 635,1037)
    findPic("lingjiang1.bmp",90, 541,938 , 630,1035)
    --点击在线礼包
    findPic("zaixianlibao.bmp",90, 300,404 , 516,593 )
    --全部领取
    findPic("quanbulingqu.bmp",90,  43,471 , 150,655 )
    
    --签到
    
    --点击界面领奖
    findPic("lingjiang.bmp",90, 541,938 , 630,1035)
    --点击界面领奖2
    findPic("lingjiang_1.bmp",90, 541,944 , 635,1037)
    findPic("lingjiang1.bmp",90, 541,938 , 630,1035)
    --点击30日签到
    findPic("qiandao.bmp",90, 382,597 , 488,720 )
    --点击签到领奖
    findPic("qiandaolingjiang.bmp",90,  42,721 , 129,883 )
    --全部领取
    findPic("quanbulingqu.bmp",90,  43,471 , 150,655 )
    --发现进入游戏   退出
    if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
        return
    end
    --退出领奖界面
    --click( 361,953 )
    findPic("tuichulingjiang.bmp",90, 550,950 , 631,1045)
    --退出签到
    findPic("tuichuqiandao.bmp",90, 557,841 , 612,904 )
    notifyMessage("领奖完毕",2000)
    mSleep(3000)
end                                      
--天降神兵
function shenbing()
    --后台到前台
    qiantai()
    mSleep(2000)
    notifyMessage("开始神兵抽取",2000)
    logD("抽取天降神兵")
    mSleep(3000)
    --点击奇遇
    findPic("qiyu.bmp",90, 452,878 , 554,985 )
    --点击天降神兵
    if findPic_boolean("tianjiangshenbing.bmp",90, 106,229 , 321,430 ) then
        click(x,y)
        --抽取一次45级
        findPic("chouqu45ji.bmp",90, 149,179 , 217,301 )
        --发现进入游戏   退出
        if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
            return
        end
        --关闭界面
        click( 401,1032)
        --点击60级装备
        findPic("60ji.bmp",90, 190,448 , 489,683 )
        --抽取一次60级装备
        findPic("chouqu60ji.bmp",90, 182,536 , 210,568 )
        --发现进入游戏   退出
        if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
            return
        end
        --关闭界面
        click( 401,1032)
        --点击70级装备
        findPic("chouqu60ji.bmp",90, 176,801 , 213,835 )
        --抽取一次70级装备
        findPic("chouqu45ji.bmp",90, 149,179 , 217,301 )
        --关闭界面
        click( 401,1032)
    end
    --关闭天降神兵界面
    findPic("guanbishenbing.bmp",90, 563,1058, 639,1132)
    notifyMessage("神兵抽取结束",2000)
    mSleep(3000)
end
--[[
--断网计数
function duanwang(counts)
    --断网重试
    x,y = findMultiColorInRegionFuzzy(color_chongshi, 90, 282,539 , 311,591 )
    if x~=-1 and y ~= -1 then
        click(x,y)
        counts = counts + 1 
        logD("断线次数"..counts)
    else
        logD("无重试的断网重启操作")
        --关闭游戏在开启游戏
        appKill("com.zeus.cangqiongbian")
        mSleep(4000)
        appRun("com.zeus.cangqiongbian")
        mSleep(5000)
    end
    if counts >5 then
        counts = 0
        logD("重试断网重启操作")
        --关闭游戏在开启游戏
        appKill("com.zeus.cangqiongbian")
        mSleep(4000)
        appRun("com.zeus.cangqiongbian")
        mSleep(5000)  
    end
    return counts
end
--]]
function jiesuo()
    logD("屏幕解锁")
    mSleep(1000)
    --点亮屏幕
    keyDown("HOME");    -- HOME键按下
    mSleep(100);        --延时100毫秒
    keyUp("HOME");  
    mSleep(1000)
    -- HOME键抬起
    --滑动解锁
    moveTo(  63,978 , 598,983 )
    mSleep(3000)
end
--后台到前台
function qiantai()
    --电池
    if findPic_boolean("dianchi.bmp",90, 540,2   , 636,39  ) then
        logD("电池启动游戏")
        appRun("com.zeus.cangqiongbian")
    end
end

--关闭弹窗
function guanbi()
    --退出签到
    findPic("tuichuqiandao.bmp",90, 557,841 , 612,904 )
    --后台到前台
    qiantai()
    --连接资源
    if findPic_boolean("lianjieziyuan.bmp",90, 223,367 , 403,756 ) then
        logD("连接资源卡死。重启")
        --关闭游戏在开启游戏
        appKill("com.zeus.cangqiongbian")
        mSleep(4000)
        appRun("com.zeus.cangqiongbian")
        mSleep(5000)
        return
    end
    --连接资源
    if findPic_boolean("lianjieziyuan_1.bmp",90, 223,367 , 403,756 ) then
        logD("连接资源1卡死。重启")
        --关闭游戏在开启游戏
        appKill("com.zeus.cangqiongbian")
        mSleep(4000)
        appRun("com.zeus.cangqiongbian")
        mSleep(5000)
        return
    end
    
    --登陆界面卡死，无账号区号信息
        if findPic_boolean("noaccount.bmp",90, 179,378 , 336,762 ) then
            logD("无账号区号信息卡死。重启")
            --关闭游戏在开启游戏
            appKill("com.zeus.cangqiongbian")
            mSleep(4000)
            appRun("com.zeus.cangqiongbian")
            mSleep(5000)
            return
        end
        --关闭队伍界面
        findPic("guanbiduiwu.bmp",90, 578,1067, 638,1134)
        --领取红包
        findPic("hongbao.bmp",90, 471,737 , 528,800 )
        --取消网络选择
        findPic("wangluoquxiao.bmp",90,  68,526 , 142,638 )
        --账号界面登陆
        findPic("denglu.bmp",90, 147,470 , 268,658 )
        --立即登录
        findPic("lijidenglu.bmp",90, 221,492 , 287,646 )
        --断线登陆界面进入游戏    
        findPic("jinruyouxi.bmp",90,  16,382 , 171,738 )
        findPic("jinruyouxi_2.bmp",90,16,382 , 171,738 )
        --全部领取
        findPic("quanbulingqu.bmp",90,  43,471 , 150,655 )
        --登陆错误
        findPic("quedingcuowu.bmp",90, 204,498 , 276,625 )
        findPic("dlcwqd.bmp",90, 197,484 , 282,628 )
        findPic("denglucuowu_2.bmp",90, 200,510 , 283,621 )
        --立即登录
        findPic("lijidenglu.bmp",90, 221,492 , 287,646 )
        zhaojuese()
        --角色进入
        findMuColor(color_juesejinru,90,   2,888 , 113,1130)
        --活动公告
        findPic("huodong.bmp",90,  51,489 , 120,638 )
        --精彩内容
        findPic("jingcaineirong.bmp",90, 539,887 , 625,981 )
        --关闭离线挂机界面
        findPic("guanbiguaji.bmp",90, 427,755 , 492,834 )
        --sim卡提示
        findPic("SIMhao.bmp",90, 208,385 , 313,821 )
        --取消家族boss提示
        findPic("jiazuboss.bmp",90, 193,595 , 267,727 )
        --取消家族boss进入提示
        findPic("bossjinru.bmp",90, 194,595 , 271,726 )
        --关闭界面
        findPic("guanbijiemian.bmp",90, 567,1065, 639,1133)
        --关闭窗口
        findPic("guanbick.bmp",90, 582,1074, 638,1133)
        --手机商城登陆取消
        findPic("shangchengquxiao.bmp",90, 320,302 , 427,613 )
        --关闭副本难度选择
        findPic("guanbifb_1.bmp",90, 572,1068, 639,1133)
        --关闭界面
        findPic("guanbijiemian.bmp",90, 567,1065, 639,1133)
        --关闭bg窗口
        findPic("guanbibeibao.bmp",90, 573,1065, 639,1133)
        --断网重试
        findMuColor(color_chongshi, 90,259,502 , 329,628 )
        --关闭移动
        findPic("guanbiyidong.bmp",90, 432,703 , 491,761 )
        --关闭世界地图
        findPic("guanbishijie.bmp",90, 579,1076, 640,1134)
        --关闭副本1
        findPic("guanbifuben_1.bmp",90, 576,1070, 639,1134)
        --关闭NPC对话  天蛇府弟子
        findPic("guanbiNPC_1.bmp",90, 575,268 , 638,328 )
        --离开副本
        findMuColor(color_likaifuben,90, 3,932 ,  78,1110)
        --关闭设置
        findPic("guanbishezhi.bmp",90, 485,732 , 602,853 )
        --纳戒已完成
        findPic("wancheng.bmp",90, 171,112 , 301,357 )
        --断线登陆界面进入游戏
        findPic("jinruyouxi.bmp",90,  16,382 , 171,738 )
        findPic("jinruyouxi_2.bmp",90,16,382 , 171,738 )
        --账号界面登陆
        findPic("denglu.bmp",90, 147,470 , 268,658 )
        --登陆错误
        findPic("denglucuowu.bmp",90, 191,436 , 287,733 )
        zhaojuese()
        --角色进入
        findMuColor(color_juesejinru,90,   2,888 , 113,1130)
        --活动公告
        findPic("huodong.bmp",90,  51,489 , 120,638 )
        --关闭邮件界面
        findPic("guanbiyoujian.bmp",90, 575,1068, 639,1134)
        --精彩内容
        findPic("jingcaineirong.bmp",90, 539,887 , 625,981 )
        --关闭离线挂机界面
        findPic("guanbiguaji.bmp",90, 427,755 , 492,834 )
        --sim卡提示
        findPic("SIMhao.bmp",90, 208,385 , 313,821 )
        --取消家族boss提示
        findPic("jiazuboss.bmp",90, 193,595 , 267,727 )
        --取消家族boss进入提示
        findPic("bossjinru.bmp",90, 194,595 , 271,726 )
        --关闭背包满提示
        findPic("guanbitishi.bmp",90, 432,744 , 492,813 )
        --手机商城登陆取消
        findPic("shangchengquxiao.bmp",90, 320,302 , 427,613 )
    
end
--防卡死不动
function kasi()
    --如果发现背包
    if findPic_boolean("beibao.bmp",90,   4,531 ,  57,594 ) then
        --下
        touchDown(0,  66,112 )
        mSleep(500)
        touchUp(0)
        --上
        mSleep(200)
        touchDown(0, 130,110 )
        mSleep(500)
        touchUp(0)
        --挂机
        findMuColor(color_guaji,90, 308,1040, 390,1131)
        mSleep(8000)
    end
end
--界面卡死不动
function jiemiankasi()
    time1 = os.time()
    while true do
        time2 = os.time()
        --4分钟重启
        if (time2 - time1) > 240 then
            time1 = os.time()
            notifyMessage("无社区卡死重启")
            mSleep(1500)
            logD("无社区卡死重启")
            --关闭游戏在开启游戏
            appKill("com.zeus.cangqiongbian")
            mSleep(4000)
            appRun("com.zeus.cangqiongbian")
            mSleep(5000)
            return
        end
        --关闭弹窗
        guanbi()
        exception()
        -------------------------------------------------------------------------------------------11111111111111111111111111111111
        --登陆界面进入游戏
        if findPic_boolean("denglujinru.bmp",90,  48,577 , 155,708 ) then
            click(x,y)
            return
        end
        --角色进入   
        if findMuColor_boolean(color_juesejinru,90,   2,888 , 113,1130) then
            click(x,y)
            return
        end
        --社区图标
        if findPic_boolean("shequ.bmp",90, 536,639 , 634,857 ) then
            return
        end
    end
end
--异常与固定弹窗
function exception()
    --关闭配件
    findPictf("guanbipeijian.bmp",90, 227,509 , 291,628 )
    --取消开启自动下载
    findPictf("quxiaoIOS.bmp",90, 170,376 , 227,484 )
	--领取红包
    findPictf("hongbao.bmp",90, 471,737 , 528,800 )
	--取消网络选择
    findPictf("wangluoquxiao.bmp",90,  68,526 , 142,638 )
    --账号界面登陆
    findPictf("denglu.bmp",90, 147,470 , 268,658 )
    --立即登录
    findPictf("lijidenglu.bmp",90, 221,492 , 287,646 )
    --断线登陆界面进入游戏    
    findPictf("jinruyouxi.bmp",90,  16,382 , 171,738 )
    findPictf("jinruyouxi_2.bmp",90,16,382 , 171,738 )
    --全部领取
    findPictf("quanbulingqu.bmp",90,  43,471 , 150,655 )
    --登陆错误
    findPictf("quedingcuowu.bmp",90, 204,498 , 276,625 )
    findPictf("dlcwqd.bmp",90, 197,484 , 282,628 )
    findPictf("denglucuowu_2.bmp",90, 200,510 , 283,621 )
    --立即登录
    findPictf("lijidenglu.bmp",90, 221,492 , 287,646 )
    --关闭离线挂机界面
    findPictf("guanbilixianguaji.bmp",90, 409,739 , 500,831 )
    --角色进入
    findMuColor(color_juesejinru,90,   2,888 , 113,1130)
    --活动公告
    findPictf("huodong.bmp",90,  51,489 , 120,638 )
    --精彩内容
    findPictf("jingcaineirong.bmp",90, 539,887 , 625,981 )
    --关闭离线挂机界面
    findPictf("guanbiguaji.bmp",90, 427,755 , 492,834 )
    --sim卡提示
    findPictf("SIMhao.bmp",90, 208,385 , 313,821 )
    --取消家族boss提示
    findPictf("jiazuboss.bmp",90, 193,595 , 267,727 )
    --取消家族boss进入提示
    findPictf("bossjinru.bmp",90, 194,595 , 271,726 )
	--断网重试
    findMuColor(color_chongshi, 90,259,502 , 329,628 )
	--点击纳戒
    findPictf("najie.bmp",90, 192,20  , 286,127 )
    --获得新物品
    findMuColor(color_huode,90, 269,115 , 305,243 )
    --确定组队
    findPictf("chuanchengqueding.bmp",90, 209,435 , 246,517 )
	--点开任务眼
    if not findMuColor_boolean(color_renwuyan,90, 254,3 , 316,68 ) then
        --logD("任务眼关闭状态下打开任务眼")
        --点击打开任务眼
        findMuColor(color_renwu,90, 288,0, 408,94)
    end
    --运行游戏
    if not appRunning("com.zeus.cangqiongbian") then
        mSleep(2000)
        --进行解锁
        jiesuo()                                 
        --横屏SIM卡提示
        findPic("SIMhao_hengp.bmp",90, 210,581 , 438,663 )
        --sim卡提示
        findPic("SIMhao.bmp",90, 208,385 , 313,821 )
        logD("while外启动游戏")
        appRun("com.zeus.cangqiongbian")
        mSleep(10000)
        --手机商城登陆取消
        findPic("shangchengquxiao.bmp",90, 301,282 , 637,607 )
        --sim卡提示
        findPic("SIMhao.bmp",90, 208,385 , 313,821 )
        mSleep(40000)
    end
	--后台到前台
    qiantai()
	--失去连接重启游戏
    if findMuColor_boolean(color_duankailianjie,90, 154,452 , 203,665 ) then
        --断网重试
        findMuColor(color_chongshi, 90,259,502 , 329,628 )
        mSleep(3000)
        if findMuColor_boolean(color_duankailianjie,90, 154,452 , 203,665 ) then
            logD("失去连接重启游戏")
            --关闭游戏在开启游戏
            appKill("com.zeus.cangqiongbian")
            mSleep(4000)
            appRun("com.zeus.cangqiongbian")
            mSleep(5000)  
        end
    end
	--连接资源
    if findPic_boolean("lianjieziyuan.bmp",90, 223,367 , 403,756 ) or 
       findPic_boolean("lianjieziyuan_1.bmp",90, 223,367 , 403,756 ) then
        mSleep(3000)
        if findPic_boolean("lianjieziyuan.bmp",90, 223,367 , 403,756 ) or 
          findPic_boolean("lianjieziyuan_1.bmp",90, 223,367 , 403,756 ) then
            logD("连接资源卡死。重启")
            --os.execute("reboot")
            --关闭游戏在开启游戏
            appKill("com.zeus.cangqiongbian")
            mSleep(4000)
            appRun("com.zeus.cangqiongbian")
            mSleep(5000)
        end
    end
	--登陆界面卡死，无账号区号信息
    if findPic_boolean("noaccount.bmp",90, 179,378 , 336,762 ) then
        logD("无账号区号信息卡死。重启")
        --关闭游戏在开启游戏
        appKill("com.zeus.cangqiongbian")
        mSleep(4000)
        appRun("com.zeus.cangqiongbian")
        mSleep(5000)
    end
end
--主函数
function main()
    --运行游戏
    if not appRunning("com.zeus.cangqiongbian") then
        mSleep(2000)
        --进行解锁
        jiesuo()                                 
        --横屏SIM卡提示
        findPic("SIMhao_hengp.bmp",90, 210,581 , 438,663 )
        --sim卡提示
        findPic("SIMhao.bmp",90, 208,385 , 313,821 )
        logD("while外启动游戏")
        appRun("com.zeus.cangqiongbian")
        mSleep(10000)
        --手机商城登陆取消
        findPic("shangchengquxiao.bmp",90, 301,282 , 637,607 )
        --sim卡提示
        findPic("SIMhao.bmp",90, 208,385 , 313,821 )
        mSleep(40000)
    end
    --关闭界面
    guanbi()
    --sim卡提示
    findPic("SIMhao.bmp",90, 208,385 , 313,821 )
    --取消网络选择
    findPic("wangluoquxiao.bmp",90,  68,526 , 142,638 )
    --登陆界面进入游戏
    findPic("jinruyouxi.bmp",90,  16,382 , 171,738 )
    mSleep(2500)
    --登陆界面进入游戏
    findPic("jinruyouxi.bmp",90,  16,382 , 171,738 )
    findPic("jinruyouxi_2.bmp",90,16,382 , 171,738 )
    mSleep(2500)
    --选中角色
    zhaojuese()
    --角色进入
    findMuColor(color_juesejinru,90,   2,888 , 113,1130)
    mSleep(10000)
    --活动公告
    findPic("huodong.bmp",90,  51,489 , 120,638 )
    --精彩内容
    findPic("jingcaineirong.bmp",90, 539,887 , 625,981 )
    --关闭离线挂机界面
    findPic("guanbilixianguaji.bmp",90, 409,739 , 500,831 )
    --回天蛇府
    isTsf()
    --time1 = os.time()
    --断线计数
    counts = 0
    while true do
        --运行游戏
        if appRunning("com.zeus.cangqiongbian") then
        else
            logD("while内启动游戏")
            appRun("com.zeus.cangqiongbian")
            --等待加载一分钟
            notifyMessage("等待加载一分钟",2000)
            mSleep(60000)
        end
        
        --断网计数
        --counts = duanwang(counts)
        --关闭一些弹窗和挂机
        guanbi()
        --防止界面卡死不动
        jiemiankasi()
        --每天完成侦查讨伐令任务   5.3小时
        time = os.time()
        if time%19080<600 then
            --时间
            notifyMessage("现在时间为："..time)
            --侦查任务
            zhencha()
        end
--[[       
        --正在检查资源请稍等
        x,y = findPic("zhaoziyuan.bmp",90, 299,451 , 351,681 )
        if x~=-1 and y~=-1 then
            mSleep(3000)
            x,y = findPic("zhaoziyuan.bmp",90, 299,451 , 351,681 )
            if x~=-1 and y~=-1 then
                logD("失去连接找资源重启操作")
                --关闭游戏在开启游戏
                appKill("com.zeus.cangqiongbian")
                mSleep(4000)
                appRun("com.zeus.cangqiongbian")
                mSleep(5000)
                return
            end
        end
--]]       
        --断网重启
        if findMuColor_boolean(color_duankailianjie,90, 154,452 , 203,665 ) then
            mSleep(3000)
            if findMuColor_boolean(color_duankailianjie,90, 154,452 , 203,665 ) then
                logD("失去连接重启操作")
                --关闭游戏在开启游戏
                appKill("com.zeus.cangqiongbian")
                mSleep(4000)
                appRun("com.zeus.cangqiongbian")
                mSleep(5000)
                return
            end
        end
        --买药   10小时
        time = os.time()
        if time%35940<280 then
            --断网重试
            findMuColor(color_chongshi, 259,502 , 329,628 )
            --关闭界面
            findPic("guanbijiemian.bmp",90, 567,1065, 639,1133)
            
            notifyMessage("现在时间为："..time,2000)
            mSleep(3000)
            --退出战斗
            tuizhan()
            --买药
            maiyao()
        end
        --是否在天蛇府    7fenz
        time = os.time()
        if time%421<20 then
            isTsf()
        end
--[[ 
        --关闭npc对话
        findPic("guanbiNPC.bmp",90, 575,277 , 638,327 )
        --没过9分钟走动，防止卡主不动的情况
        time = os.time()
        if time %541 <10 then
            
        end
--]]        
        --关闭一些弹窗和挂机
        guanbi()
        --防卡死
        kasi()
        --挂机
        findMuColor(color_guaji,90, 308,1040, 390,1131)
         --关闭一些弹窗和挂机
        guanbi()
--[[        
        --社区图标   UI卡没了
        x,y = findImageInRegionFuzzy(PIC_PATH.."shequ.bmp",90, 544,552 , 635,1053)
        if x==-1 and y==-1 then
            logD("无社区UI卡死。重启")
            --关闭游戏在开启游戏
            appKill("com.zeus.cangqiongbian")
            mSleep(4000)
            appRun("com.zeus.cangqiongbian")
            mSleep(5000)  
        end
--]]       
        --奇遇和锻炉和领奖 神兵       23分钟
        time = os.time()
        if time%1380<120 then
            --断网重试
            findMuColor(color_chongshi, 259,502 , 329,628 )
            --关闭界面
            findPic("guanbijiemian.bmp",90, 567,1065, 639,1133)
            notifyMessage("现在时间为："..time,2000)
            mSleep(3000)
            qiyu()
        end
        --发邮件   23小时发一次
        local timeyj = os.time()
        if timeyj%82800 < 15 then
            --发邮件
            fayoujian()
        end
        --[[
        --15.1分钟喊话
        time = os.time()
        if time%906 <20   then
            hanhua()
        end
        --]]
    end
end






